<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Para Mi Princesa - Helen‚ù§</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- FUENTE CAMBIADA -->
    <link href="https://fonts.googleapis.com/css2?family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>">
    <style>
        /************************************/
        /*    M√ìDULO DE CONFIGURACI√ìN CSS   */
        /************************************/
        :root {
            --gradient-start: #f5e6d3;
            --gradient-middle: #ffe4d1;
            --gradient-end: #fff2e6;
            --main-text-color: #444;
            --counter-text-color: #5c5c5c;
            --counter-number-color: #333;
            --cursor-color: #444;
            --full-tree-base-width-desktop: 40vw;
            --full-tree-base-width-mobile: 70vw;
        }

        /************************************/
        /*        ESTILOS GLOBALES          */
        /************************************/
        html {
            min-height: 100%;
            background: url('https://www.dl.dropboxusercontent.com/scl/fi/6jkkq3yh3kk15enckv0ak/back.png?rlkey=olh1qimqz20c0hh9ux8baoyvl&st=8d98per2') no-repeat center center fixed;
            background-size: cover;
            background-color: #f5e6d3;
        }

        /* ----- FUENTE APLICADA A TODO EL TEXTO ----- */
        body {
            margin: 0; padding: 0;
            font-family: 'Sour Gummy', cursive; /* Fuente cambiada */
            overflow-x: hidden;
            overflow-y: auto;
            width: 100%;
            -webkit-user-select: none; -ms-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        img {
            -webkit-user-drag: none; -khtml-user-drag: none; -moz-user-drag: none; -o-user-drag: none;
            user-drag: none; pointer-events: none;
        }
        
        .love-container {
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            width: 95%; max-width: 1400px; margin: 0 auto; padding: 5vh 0;
        }

        .counter-container {
            position: relative; text-align: center; margin-bottom: 2vh;
            opacity: 0; animation: fadeInUp 1.5s ease-out 1s forwards;
        }
        .counter-container p { font-size: 1.8rem; color: var(--counter-text-color); margin-bottom: 5px; }
        #love-counter { font-size: 2rem; font-weight: bold; color: var(--counter-number-color); }

        .tree-container {
            flex-shrink: 0; position: relative; display: flex; justify-content: center; align-items: flex-end;
            margin-right: 0; margin-bottom: 2vh; width: calc(var(--full-tree-base-width-desktop) + 100px);
            max-width: 650px; min-width: 400px;
        }
        
        .full-tree-wrapper {
            position: relative; width: var(--full-tree-base-width-desktop);
            max-width: 550px; min-width: 300px; aspect-ratio: 550 / 750;
        }

        .tree-image-wrapper {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 75%;
            clip-path: ellipse(0% 0% at 50% 100%); animation: grow-up-curved 2.5s ease-out forwards; z-index: 1; 
        }
        #love-tree-img { width: 100%; height: 100%; object-fit: contain; position: absolute; bottom: 0; }
        @keyframes grow-up-curved { to { clip-path: ellipse(150% 100% at 50% 100%); } }

        .heart-canopy {
            position: absolute; top: 0; left: 45%; transform: translateX(-50%);
            width: 110%; height: 70%; z-index: 2;
        }

        .heart {
            position: absolute; width: 35px; height: 35px; opacity: 0; background-size: contain;
            transform-origin: center; transform: rotate(var(--rotation, 0deg));
            animation: grow-in 2s forwards; will-change: transform, opacity; backface-visibility: hidden;
        }

        .heart:not(.falling-heart):not(.click-heart) {
            animation: grow-in 1.5s forwards, gentle-sway 4s ease-in-out infinite;
            animation-delay: var(--sway-delay, 0s), calc(1.5s + var(--sway-delay, 0s));
        }

        @keyframes grow-in { 0% { transform: scale(0) rotate(var(--rotation, 0deg)); opacity: 0; } 100% { transform: scale(1) rotate(var(--rotation, 0deg)); opacity: 1; } }
        @keyframes gentle-sway { 0%, 100% { transform: scale(1) rotate(var(--rotation, 0deg)) translate(0, 0); } 25% { transform: scale(1) rotate(var(--rotation, 0deg)) translate(2px, -1px); } 50% { transform: scale(1) rotate(var(--rotation, 0deg)) translate(-1px, 1px); } 75% { transform: scale(1) rotate(var(--rotation, 0deg)) translate(1px, -0.5px); } }
        
        .falling-heart { animation: fall-wind 5s linear forwards; will-change: transform, opacity; }
        @keyframes fall-wind { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(400px, 350px) rotate(720deg); opacity: 0; } }

        .click-heart {
            position: fixed; z-index: 100; background-size: contain; width: 35px; height: 35px;
            pointer-events: none; opacity: 0; animation: firework-and-fall var(--fall-duration) linear forwards;
            will-change: transform, opacity;
        }
        @keyframes firework-and-fall { 0% { transform: translate(0, 0) scale(0.5); opacity: 1; } 15% { transform: translate(var(--burst-x), var(--burst-y)) scale(1.1) rotate(0deg); opacity: 1; } 100% { transform: translate(calc(var(--burst-x) + var(--wind-x)), 110vh) scale(0.4) rotate(1080deg); opacity: 0; } }
        
        .floating-phrase {
            position: fixed;
            z-index: 101;
            pointer-events: none;
            font-family: 'Sour Gummy', cursive; /* Fuente cambiada */
            font-size: 2rem;
            color: #000;
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 194, 209, 0.8), 0 0 12px rgba(255, 194, 209, 0.8);
            opacity: 0;
            animation: float-and-fade 4s ease-out forwards;
            will-change: transform, opacity;
            white-space: nowrap;
        }
        @keyframes float-and-fade {
            0% { transform: translate(-50%, 0) scale(0.8); opacity: 1; }
            100% { transform: translate(-50%, -120px) scale(1.1); opacity: 0; }
        }

        .petal {
            position: fixed; z-index: 200; pointer-events: none; width: 60px; height: 60px;
            background-size: contain; opacity: 0.5; animation: fall-petal linear forwards; will-change: transform;
        }
        @keyframes fall-petal { from { transform: translateY(-10vh) translateX(var(--start-x, 0)) rotate(0deg); } to { transform: translateY(110vh) translateX(var(--end-x, 40vw)) rotate(720deg); } }

        .text-container {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 100%; max-width: 650px; padding: 0 20px; box-sizing: border-box; text-align: center;
        }
        .love-message {
            font-family: 'Sour Gummy', cursive; /* Fuente cambiada */
            font-size: 1.2rem; color: var(--main-text-color);
            line-height: 1.6; min-height: auto; text-align: justify; opacity: 0;
            animation: fadeInUp 1.5s ease-out 3s forwards;
        }
        .love-message .cursor { display: inline-block; background-color: var(--cursor-color); width: 8px; height: 1.5rem; vertical-align: bottom; animation: blink 0.8s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .signature-bears-desktop {
            display: block; max-width: 280px; margin: 0; position: absolute; bottom: 0; left: 85%;
            z-index: 2; opacity: 0; animation: fadeInUp 1.5s ease-out 3s forwards;
        }
        .signature-bears-mobile { display: none; }

        .music-button {
            position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.8); border: 2px solid #ff6b6b; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 20px; z-index: 1000;
            transition: all 0.3s ease; backdrop-filter: blur(10px); opacity: 0;
            animation: bounceIn 1s ease-out 4s forwards;
        }
        .music-button:hover { background: rgba(255, 107, 107, 0.2); transform: scale(1.1); }
        .music-button.playing { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); } }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 0% { opacity: 0; transform: scale(0.3); } 50% { opacity: 1; transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { opacity: 1; transform: scale(1); } }
        
        .carousel-perspective-wrapper {
            perspective: 1200px; display: flex; justify-content: center; align-items: center;
            margin-top: 50px; padding: 20px 0; width: 100%; min-height: 450px;
            opacity: 0; animation: fadeInUp 1.5s ease-out 4s forwards;
            margin-bottom: 40vh;
        }
        .carousel-container-3d { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; display: flex; justify-content: center; align-items: center; }
        .carousel-3d { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: grab; touch-action: none; }
        .carousel-3d:active { cursor: grabbing; }
        .carousel-item-3d { position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto; width: 240px; height: 330px; transform-style: preserve-3d; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.3); border: 2px solid rgba(255, 255, 255, 0.8); background: #000; }
        .carousel-item-3d img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; user-select: none; pointer-events: none; -webkit-box-reflect: below 1px linear-gradient(transparent, transparent, #0004); }

        @media (max-width: 768px) {
            body { touch-action: auto; }
            .love-container { padding: 3vh 0; }
            .counter-container { margin-bottom: 2vh; }
            .counter-container p { font-size: 1.2rem; }
            #love-counter { font-size: 1.4rem; line-height: 1.3; }
            .tree-container { width: 100%; min-width: unset; margin-bottom: 3vh; max-width: none; }
            .full-tree-wrapper { width: var(--full-tree-base-width-mobile); max-width: 350px; min-width: unset; }
            .signature-bears-desktop { display: none; }
            .signature-bears-mobile { display: block; position: absolute; width: 115px; bottom: 0; right: -25px; z-index: 2; opacity: 0; animation: fadeInUp 1.5s ease-out 3s forwards; }
            .text-container { padding: 0 5%; width: 90%; }
            .love-message { font-size: 1.2rem; line-height: 1.5; }
            .heart, .click-heart { width: 25px; height: 25px; }
            .petal { width: 40px; height: 40px; }
            .music-button { bottom: 10px; left: 10px; width: 40px; height: 40px; font-size: 16px; }
            .carousel-perspective-wrapper { perspective: 1000px; min-height: 380px; margin-top: 30px; }
            .carousel-item-3d { width: 190px; height: 260px; }
            .floating-phrase { font-size: 1.2rem; white-space: normal; max-width: 90vw; text-align: center; }
        }
        @media (max-width: 480px) {
            .carousel-perspective-wrapper { perspective: 800px; min-height: 300px; }
            .carousel-item-3d { width: 160px; height: 220px; }
            .signature-bears-mobile { width: 100px; right: -15px; }
        }
    </style>
</head>
<body>

    <div class="love-container">
        <div class="counter-container">
            
            <div id="love-counter"></div>
        </div>

        <div class="tree-container">
            <div class="full-tree-wrapper">
                <div class="heart-canopy"></div>
                <div class="tree-image-wrapper">
                     <img id="love-tree-img" src="https://www.dl.dropboxusercontent.com/scl/fi/h12iesgregm60chzzsns1/tree.png?rlkey=zx94aiz5oedyws10jyg9thj92&st=rfz3f9on" alt="Tronco de √°rbol">
                </div>
                <img src="https://www.dl.dropboxusercontent.com/scl/fi/v4bqs1uuaff8nno4zt0kd/bears.png?rlkey=jp9rq8255blkseqz25k0sjjjp&st=qg7wwu9i" alt="Osos Abrazados" class="signature-bears-mobile">
            </div>
            <img src="https://www.dl.dropboxusercontent.com/scl/fi/v4bqs1uuaff8nno4zt0kd/bears.png?rlkey=jp9rq8255blkseqz25k0sjjjp&st=qg7wwu9i" alt="Osos Abrazados" class="signature-bears-desktop">
        </div>

        <div class="text-container">
            <div class="love-message" id="love-message-text"></div>
        </div>

        <div class="carousel-perspective-wrapper">
            <div class="carousel-container-3d">
                <!-- CARRUSEL REDUCIDO A 6 IM√ÅGENES -->
                <div class="carousel-3d" id="imageCarousel">
                    <div class="carousel-item-3d"><img src="https://www.dl.dropboxusercontent.com/scl/fi/mgh5kc0d97ociuz4009fe/img1.gif?rlkey=6wcvkv1d8v95eeq6loltsznde&st=dfei5t4t" alt="Recuerdo 1"></div>
                    <div class="carousel-item-3d"><img src="https://www.dl.dropboxusercontent.com/scl/fi/8gfh9ul1cqh521uzbs16i/img2.gif?rlkey=viy8g3dycccvegd2wpf382klo&st=559vtrtl" alt="Recuerdo 2"></div>
                    <div class="carousel-item-3d"><img src="https://www.dl.dropboxusercontent.com/scl/fi/n5rtva8ej9m405h2i4raw/img3.gif?rlkey=zdwpna23iq81ym9vu8l2u3agz&st=z8fnxljt" alt="Recuerdo 3"></div>
                    <div class="carousel-item-3d"><img src="https://www.dl.dropboxusercontent.com/scl/fi/8nk1uao54de9l0zmjd67z/img4.gif?rlkey=ejfbybxw16hco3pu6hcgse1or&st=du7015az" alt="Recuerdo 4"></div>
                    <div class="carousel-item-3d"><img src="https://www.dl.dropboxusercontent.com/scl/fi/h3yn0c8vqt9o82po736f4/img5.gif?rlkey=faeoae4t5au38ysarpw7qn987&st=jumtoznn" alt="Recuerdo 5"></div>
                    <div class="carousel-item-3d"><img src="https://www.dl.dropboxusercontent.com/scl/fi/6xn6x1uvefrraip2unn9f/img6.gif?rlkey=8sxju3kbmld7yk3s4eha7iac5&st=8cv9nuso" alt="Recuerdo 6"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="music-button" id="music-button" title="Reproducir m√∫sica">üéµ</div>

    <script>
        /************************************/
        /*     M√ìDULO DE CONFIGURACI√ìN JS   */
        /************************************/
        const CONFIG = {
            startDate: '2024-01-23T00:50:00',
            
            // MENSAJE CAMBIADO Y GENERALIZADO
            loveText: `Buenos d√≠as, princesa ‚ù§Ô∏è‚ú®

            Hoy no puedo evitar sentir que todo tiene un significado especial. Vivir nuestro primer San Valent√≠n juntos llega justo en un momento donde ya llevamos un mes caminando de la mano ‚ù§Ô∏è, aprendiendo uno del otro, creciendo y entendiendo lo que realmente significa compartir.

            Este mes ha sido de ense√±anza y aprendizaje mutuo üìñ, de paciencia, de risas üòä y de conversaciones que me han ayudado a comprender cu√°nto vales para m√≠. Sin darme cuenta, en tan poco tiempo te volviste parte de mi vida, de mis pensamientos y de mis d√≠as üåô.

            Todo lo que hemos vivido me hizo entender algo muy claro: te amo ‚ù§Ô∏è, y te amo m√°s de lo que imagin√©. Gracias por llegar, por quedarte y por ense√±arme tanto ‚ù§Ô∏è.

            Y aunque mi mundo siempre ha estado lleno de l√≥gica, n√∫meros y soluciones üíª, contigo aprend√≠ que no todo se programa ni se controla. A veces, cuando un ingeniero de sistemas se enamora, simplemente deja que el coraz√≥n haga lo suyo üí´.

            Feliz de compartir este primer San Valent√≠n y nuestro primer mes juntos üíï.

            Mi princesa ‚ù§Ô∏è`,
            
            // FRASES CAMBIADAS Y GENERALIZADAS
            clickingPhrases: [
                "Te quiero hermosa‚ù§Ô∏è",
                "Eres mi persona favorita ‚ú®",
                "Cada d√≠a te elijo a ti ü•∞",
                "Juntos es mi lugar feliz üíñ",
                "Gracias por existir üåπ",
                "Contigo todo es mejor üòä",
                "Mi coraz√≥n es tuyo üíò"
            ],

            heartColors: ['#ff6b6b', '#ffa07a', '#ffc3a0', '#f0932b', '#e84393', '#d14a7e', '#ff7979', '#ff4757', '#e056fd'],
            canopyHeartCount: { desktop: 700, mobile: 400 },
            fallingCanopyHeartFrequency: 400,
            clickBurstCount: 7,
            animation: { initialTreeAppear: 2.5, initialHeartsAppear: 1.5, canopyFallDuration: 5, clickFallDuration: 6, },
            clickBurst: { distance: { min: 60, max: 90 }, wind: { min: 250, max: 450 }, },
            petal: { colors: ['#ffc2d1', '#ffb3c6', '#ff8fab'], frequency: 1000, duration: { min: 8, max: 12 }, },
            initialDelay: 800,
            typingSpeed: 45, // Un poco m√°s lento para la nueva fuente
        };

        class MusicSystem {
            constructor() {
                this.audio = null; this.isPlaying = false; this.clickCount = 0;
                this.button = document.getElementById('music-button'); this.init();
            }
            init() {
                this.button.addEventListener('click', () => this.toggleMusic());
                document.addEventListener('click', () => this.handleFirstClick());
                document.addEventListener('touchstart', () => this.handleFirstClick());
            }
            async handleFirstClick() {
                this.clickCount++; if (this.clickCount === 1) await this.initAudio();
            }
            async initAudio() {
            try {
                    this.audio = new Audio('/CuentodeHadas.mp3');
                    this.audio.loop = true;
                    this.audio.volume = 0.7;
                    this.audio.preload = 'auto';
                    this.audio.addEventListener('error', (e) => { this.button.style.display = 'none'; });
                    setTimeout(() => { this.playMusic(); }, 1000);
                } catch (error) { 
                    this.button.style.display = 'none'; 
                }
            }
            async toggleMusic() { if (this.isPlaying) this.pauseMusic(); else await this.playMusic(); }
            async playMusic() {
                if (!this.audio) return; try { await this.audio.play(); this.isPlaying = true; this.button.textContent = 'üéµ'; this.button.classList.add('playing'); } catch (error) {}
            }
            pauseMusic() { if (!this.audio) return; this.audio.pause(); this.isPlaying = false; this.button.textContent = 'üéµ'; this.button.classList.remove('playing'); }
        }
        
        function initCarousel() {
            const carousel = document.getElementById('imageCarousel'); if (!carousel) return;
            const items = carousel.querySelectorAll('.carousel-item-3d');
            let radius, isDragging = false, startX = 0, currentRotation = 0, targetRotation = 0, autoRotateTimeout, animationFrameId;
            const angle = 360 / items.length;
            
            // ----- RADIO DEL CARRUSEL MODIFICADO PARA ALEJARLO -----
            const updateRadius = () => { 
                if (window.innerWidth <= 480) { radius = 200; } // M√°s peque√±o en m√≥vil
                else if (window.innerWidth <= 850) { radius = 250; } // Mediano
                else { radius = 300; } // Grande
            };

            const arrangeItems = () => { updateRadius(); items.forEach((item, index) => { item.style.transform = `rotateY(${angle * index}deg) translateZ(${radius}px)`; }); };
            const dragStart = (e) => { isDragging = true; startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX; carousel.style.transition = 'none'; };
            const dragging = (e) => {
                if (!isDragging) return; const currentX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const diffX = currentX - startX; const sensitivity = window.innerWidth <= 850 ? 0.7 : 0.5;
                targetRotation = currentRotation + diffX * sensitivity; carousel.style.transform = `rotateY(${targetRotation}deg)`;
            };
            const dragEnd = () => { if (!isDragging) return; isDragging = false; carousel.style.transition = 'transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; currentRotation = targetRotation; startAutoRotate(); };
            const animateRotation = () => {
                if (isDragging) { animationFrameId = requestAnimationFrame(animateRotation); return; }
                const rotationSpeed = 0.2; targetRotation -= rotationSpeed; currentRotation -= rotationSpeed;
                carousel.style.transform = `rotateY(${targetRotation}deg)`; animationFrameId = requestAnimationFrame(animateRotation);
            };
            const stopAutoRotate = () => { if (animationFrameId) cancelAnimationFrame(animationFrameId); clearTimeout(autoRotateTimeout); };
            const startAutoRotate = () => { stopAutoRotate(); animationFrameId = requestAnimationFrame(animateRotation); };
            carousel.addEventListener('mousedown', dragStart); document.addEventListener('mousemove', dragging); document.addEventListener('mouseup', dragEnd);
            carousel.addEventListener('touchstart', dragStart, { passive: true }); carousel.addEventListener('touchmove', dragging, { passive: true }); carousel.addEventListener('touchend', dragEnd);
            arrangeItems(); startAutoRotate(); window.addEventListener('resize', arrangeItems);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const canopy = document.querySelector('.heart-canopy');
            const messageElement = document.getElementById('love-message-text');
            const totalHearts = window.innerWidth <= 768 ? CONFIG.canopyHeartCount.mobile : CONFIG.canopyHeartCount.desktop;
            const startDate = new Date(CONFIG.startDate);
            let phraseIndex = 0;
            
            new MusicSystem();

            function pluralize(value, singular, plural) { return `${value} ${value === 1 ? singular : plural}`; }

            function updateCounter() {
                const now = new Date(); const diff = now - new Date(2026, 0, 14, 19, 0, 0); const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor(diff / (1000 * 60 * 60)) % 24; const minutes = Math.floor(diff / (1000 * 60)) % 60;
                const seconds = Math.floor(diff / 1000) % 60;
                document.getElementById('love-counter').innerText = 
                    `${pluralize(days, 'd√≠a', 'd√≠as')}, ${pluralize(hours, 'hora', 'horas')}, ${pluralize(minutes, 'minuto', 'minutos')} y ${pluralize(seconds, 'segundo', 'segundos')}`;
            }

            let charIndex = 0;
            function typeWriter() {
                if (charIndex < CONFIG.loveText.length) {
                    messageElement.parentElement.style.opacity = 1;
                    messageElement.innerHTML = CONFIG.loveText.substring(0, charIndex + 1).replace(/\n/g, '<br>') + '<span class="cursor"></span>';
                    charIndex++; setTimeout(typeWriter, CONFIG.typingSpeed);
                } else { messageElement.innerHTML = CONFIG.loveText.replace(/\n/g, '<br>'); }
            }
            
            function getPointInHeartShape(width, height) {
                let t = Math.random() * 2 * Math.PI; let r = Math.sqrt(Math.random());
                let x = r * (16 * Math.pow(Math.sin(t), 3)); let y = -r * (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                return { x: (x / 32 + 0.5) * width, y: (y / 30 + 0.45) * height };
            }

            function createHeartElement(colorPalette = CONFIG.heartColors) {
                const heart = document.createElement('div'); const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                const heartSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="${color}"/></svg>`;
                heart.style.backgroundImage = `url('data:image/svg+xml;utf8,${encodeURIComponent(heartSVG)}')`;
                const rotation = Math.random() * 90 - 45; heart.style.setProperty('--rotation', `${rotation}deg`);
                const swayDelay = Math.random() * 1.5; heart.style.setProperty('--sway-delay', `${swayDelay}s`);
                return heart;
            }

            function createCanopyHeart(isFalling = false) {
                const heart = createHeartElement(); const canopyRect = canopy.getBoundingClientRect();
                if(canopyRect.width > 0) { const point = getPointInHeartShape(canopyRect.width, canopyRect.height); heart.style.left = `${point.x}px`; heart.style.top = `${point.y}px`; }
                if (isFalling) { heart.classList.add('heart', 'falling-heart'); heart.style.animationDuration = CONFIG.animation.canopyFallDuration + 's'; heart.style.opacity = '1'; } 
                else { heart.classList.add('heart'); heart.style.animationDuration = CONFIG.animation.initialHeartsAppear + 's'; heart.style.animationDelay = `${Math.random() * CONFIG.animation.initialTreeAppear}s`; }
                canopy.appendChild(heart);
                if (isFalling) { setTimeout(() => heart.remove(), CONFIG.animation.canopyFallDuration * 1000); }
            }
            
            document.addEventListener('click', function(event) {
                if (event.target.closest('.carousel-3d, .music-button')) return;
                
                const phrase = document.createElement('div');
                phrase.classList.add('floating-phrase');
                phrase.textContent = CONFIG.clickingPhrases[phraseIndex];
                phrase.style.left = `${event.clientX}px`;
                phrase.style.top = `${event.clientY}px`;
                document.body.appendChild(phrase);
                phraseIndex = (phraseIndex + 1) % CONFIG.clickingPhrases.length;
                setTimeout(() => phrase.remove(), 4000);

                for (let i = 0; i < CONFIG.clickBurstCount; i++) {
                    const heart = createHeartElement(); heart.classList.add('click-heart');
                    heart.style.left = `${event.clientX}px`; heart.style.top = `${event.clientY}px`;
                    const angle = Math.random() * 2 * Math.PI;
                    const burstDist = Math.random() * (CONFIG.clickBurst.distance.max - CONFIG.clickBurst.distance.min) + CONFIG.clickBurst.distance.min;
                    const windDist = Math.random() * (CONFIG.clickBurst.wind.max - CONFIG.clickBurst.wind.min) + CONFIG.clickBurst.wind.min;
                    const burstX = Math.cos(angle) * burstDist; const burstY = Math.sin(angle) * burstDist;
                    heart.style.setProperty('--burst-x', `${burstX}px`); heart.style.setProperty('--burst-y', `${burstY}px`);
                    heart.style.setProperty('--wind-x', `${windDist}px`); heart.style.setProperty('--fall-duration', `${CONFIG.animation.clickFallDuration}s`);
                    document.body.appendChild(heart);
                    setTimeout(() => heart.remove(), CONFIG.animation.clickFallDuration * 1000);
                }
            });
            
            function createPetal() {
                const petal = createHeartElement(CONFIG.petal.colors); petal.classList.add('petal');
                const startX = Math.random() * 30 - 10; const endX = startX + (Math.random() * 50 + 30);
                petal.style.setProperty('--start-x', `${startX}vw`); petal.style.setProperty('--end-x', `${endX}vw`);
                petal.style.left = '0';
                const duration = Math.random() * (CONFIG.petal.duration.max - CONFIG.petal.duration.min) + CONFIG.petal.duration.min;
                petal.style.animationDuration = duration + 's'; document.body.appendChild(petal);
                setTimeout(() => petal.remove(), duration * 1000);
            }

            function loadHeartsInBatches() {
                const batchSize = 50; let loaded = 0;
                function loadBatch() {
                    const remaining = Math.min(batchSize, totalHearts - loaded);
                    for (let i = 0; i < remaining; i++) { createCanopyHeart(); loaded++; }
                    if (loaded < totalHearts) setTimeout(loadBatch, 100);
                }
                loadBatch();
            }

            setTimeout(() => {
                loadHeartsInBatches();
                setInterval(() => createCanopyHeart(true), CONFIG.fallingCanopyHeartFrequency); 
                setInterval(createPetal, CONFIG.petal.frequency);
            }, CONFIG.initialDelay);

            updateCounter(); setInterval(updateCounter, 1000);
            setTimeout(typeWriter, CONFIG.initialDelay + 2500);
            initCarousel();
        });
    </script>
</body>
</html>



